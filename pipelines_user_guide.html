
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pipelines user guide &#8212; OpenSTEF  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Concepts" href="concepts.html" />
    <link rel="prev" title="User guides" href="user_guides.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="index.html">
  <img src="_static/openstef_logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="user_guides.html">
  User guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="concepts.html">
  Concepts
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="api_reference.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="community.html">
  Community
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="about_openstef.html">
  About OpenSTEF
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/OpenSTEF/openstef" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/openstef/" rel="noopener" target="_blank" title="Pypi"><span><i class="fas fa-gift"></i></span>
            <label class="sr-only">Pypi</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.lfenergy.org/projects/openstef/" rel="noopener" target="_blank" title="LFE Homepage"><span><i class="fas fa-bolt"></i></span>
            <label class="sr-only">LFE Homepage</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Pipelines user guide
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#task-implementation">
   Task implementation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-model-task-implementation">
     Train model task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-forecast-task-implementation">
     Create forecast task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimize-hyperparameters-task-implementation">
     Optimize hyperparameters task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-components-forecast-task-implementation">
     Create components forecast task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-base-case-forecast-task-implementation">
     Create base case forecast task implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pipeline-implementation">
   Pipeline implementation
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="pipelines-user-guide">
<span id="pipeline-user-guide"></span><h1>Pipelines user guide<a class="headerlink" href="#pipelines-user-guide" title="Permalink to this headline">#</a></h1>
<p>As mentioned in the <a class="reference internal" href="concepts.html#concepts"><span class="std std-ref">concepts</span></a> section, tasks are an extension of pipelines, that include getting data from a database,
raising task exceptions, and writing data to a database. In an operational setting, both tasks and pipelines can be used.
The main difference is that an operational application that leverages OpenSTEF’s tasks fuctionality is easier to implement,
whereas the pipeline functionality offers more flexibility in terms of design and implementation in addition to offering more scalability.</p>
<p>To illustrate the task as well as the pipeline <a class="reference internal" href="concepts.html#concepts"><span class="std std-ref">concept</span></a>, code snippets for both implementations are presented below.
These code snippets show two different ways in which OpenSTEF’s pipeline functionality can be integrated within an application that runs in an operational setting.</p>
<div class="section" id="task-implementation">
<h2>Task implementation<a class="headerlink" href="#task-implementation" title="Permalink to this headline">#</a></h2>
<p>Let’s first have a look at the task implementation, which is also the way it is done in the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">GitHub repository containing the reference implementation</a>.
In the case that model training, hyperparameter tuning, or forecasting is supposed to be ran according to a certain schedule, using CronJobs for example,
the task implementation is easy to set up.
However this implementation’s scalability is limited. Additionally, this implementation relies on the <a class="reference external" href="https://pypi.org/project/openstef-dbc/">the OpenSTEF database connector</a>, <code class="docutils literal notranslate"><span class="pre">openstef-dbc</span></code>,
meaning that the databases have to be set up according to the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">reference implementation</a>.
Below, code snippets are shown for different types of tasks that demonstrate the use of OpenSTEF’s task functionality.</p>
<p>Note that, apart from the imports, the implementation is the same for each type of task.</p>
<div class="section" id="train-model-task-implementation">
<h3>Train model task implementation<a class="headerlink" href="#train-model-task-implementation" title="Permalink to this headline">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">train_model</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.config.config</span> <span class="kn">import</span> <span class="n">ConfigManager</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize config manager</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="o">.</span><span class="n">load_project_config</span><span class="p">(</span><span class="n">project_root</span><span class="o">=</span><span class="n">PROJECT_ROOT</span><span class="p">)</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="create-forecast-task-implementation">
<h3>Create forecast task implementation<a class="headerlink" href="#create-forecast-task-implementation" title="Permalink to this headline">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">create_forecast</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.config.config</span> <span class="kn">import</span> <span class="n">ConfigManager</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize config manager</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="o">.</span><span class="n">load_project_config</span><span class="p">(</span><span class="n">project_root</span><span class="o">=</span><span class="n">PROJECT_ROOT</span><span class="p">)</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="optimize-hyperparameters-task-implementation">
<h3>Optimize hyperparameters task implementation<a class="headerlink" href="#optimize-hyperparameters-task-implementation" title="Permalink to this headline">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">optimize_hyperparameters</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.config.config</span> <span class="kn">import</span> <span class="n">ConfigManager</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize config manager</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="o">.</span><span class="n">load_project_config</span><span class="p">(</span><span class="n">project_root</span><span class="o">=</span><span class="n">PROJECT_ROOT</span><span class="p">)</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="create-components-forecast-task-implementation">
<h3>Create components forecast task implementation<a class="headerlink" href="#create-components-forecast-task-implementation" title="Permalink to this headline">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">create_components_forecast</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.config.config</span> <span class="kn">import</span> <span class="n">ConfigManager</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize config manager</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="o">.</span><span class="n">load_project_config</span><span class="p">(</span><span class="n">project_root</span><span class="o">=</span><span class="n">PROJECT_ROOT</span><span class="p">)</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="create-base-case-forecast-task-implementation">
<h3>Create base case forecast task implementation<a class="headerlink" href="#create-base-case-forecast-task-implementation" title="Permalink to this headline">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">create_basecase_forecast</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.config.config</span> <span class="kn">import</span> <span class="n">ConfigManager</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize config manager</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="o">.</span><span class="n">load_project_config</span><span class="p">(</span><span class="n">project_root</span><span class="o">=</span><span class="n">PROJECT_ROOT</span><span class="p">)</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pipeline-implementation">
<h2>Pipeline implementation<a class="headerlink" href="#pipeline-implementation" title="Permalink to this headline">#</a></h2>
<p>The pipeline implementation does not rely on <a class="reference external" href="https://pypi.org/project/openstef-dbc/">the OpenSTEF database connector</a>, <code class="docutils literal notranslate"><span class="pre">openstef-dbc</span></code>.
Therefore, pipelines can be used together with any kind of database setup, unlike tasks,
which require databases to be implemented according to the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">reference implementation</a>.</p>
<p>A more scalable and arguably more neat set up than the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">reference implementation</a>,
is to expose the OpenSTEF pipeline functionality through an API,
for instance by using the <a class="reference external" href="https://fastapi.tiangolo.com/">FastAPI framework</a>.
The code snippet below shows how OpenSTEF pipelines can be integrated into an API using the
<a class="reference external" href="https://mpuig.github.io/Notes/fastapi_basics/02.repository_pattern/">repository pattern</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">openstef.data_classes.model_specifications</span> <span class="kn">import</span> <span class="n">ModelSpecificationDataClass</span>
<span class="kn">from</span> <span class="nn">openstef.data_classes.prediction_job</span> <span class="kn">import</span> <span class="n">PredictionJobDataClass</span>
<span class="kn">from</span> <span class="nn">openstef.metrics.reporter</span> <span class="kn">import</span> <span class="n">Report</span>
<span class="kn">from</span> <span class="nn">openstef.model.regressors.regressor</span> <span class="kn">import</span> <span class="n">OpenstfRegressor</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.create_basecase_forecast</span> <span class="kn">import</span> <span class="n">create_basecase_forecast_pipeline</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.create_forecast</span> <span class="kn">import</span> <span class="n">create_forecast_pipeline_core</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.optimize_hyperparameters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">optimize_hyperparameters_pipeline_core</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.train_model</span> <span class="kn">import</span> <span class="n">train_model_pipeline_core</span>


<span class="k">class</span> <span class="nc">OpenstefRepository</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Repository that exposes function to interact with OpenSTEF pipelines.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">forecast_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">OpenstfRegressor</span><span class="p">,</span>
        <span class="n">modelspecs</span><span class="p">:</span> <span class="n">ModelSpecificationDataClass</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Wrapper around the forecast pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">create_forecast_pipeline_core</span><span class="p">(</span>
            <span class="n">prediction_job</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">modelspecs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">basecase_forecast_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Wrapper around the basecase forecast pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">create_basecase_forecast_pipeline</span><span class="p">(</span><span class="n">prediction_job</span><span class="p">,</span> <span class="n">input_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">train_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">modelspecs</span><span class="p">:</span> <span class="n">ModelSpecificationDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">horizons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">old_model</span><span class="p">:</span> <span class="n">OpenstfRegressor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">OpenstfRegressor</span><span class="p">,</span>
        <span class="n">Report</span><span class="p">,</span>
        <span class="n">ModelSpecificationDataClass</span><span class="p">,</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Wrapper around the train model pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">train_model_pipeline_core</span><span class="p">(</span>
            <span class="n">prediction_job</span><span class="p">,</span>
            <span class="n">modelspecs</span><span class="p">,</span>
            <span class="n">input_data</span><span class="p">,</span>
            <span class="n">old_model</span><span class="p">,</span>
            <span class="n">horizons</span><span class="o">=</span><span class="n">horizons</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">optimize_hyperparameters_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">horizons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">OpenstfRegressor</span><span class="p">,</span> <span class="n">ModelSpecificationDataClass</span><span class="p">,</span> <span class="n">Report</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Wrapper around the optimize hyperparameters pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">optimize_hyperparameters_pipeline_core</span><span class="p">(</span>
            <span class="n">prediction_job</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">horizons</span><span class="p">,</span> <span class="n">n_trials</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="user_guides.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">User guides</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="concepts.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Concepts</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2017-2022 Contributors to the OpenSTEF project.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>